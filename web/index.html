<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AI Manuals Helper</title>
<style>
 body {font-family: sans-serif; max-width: 720px; margin: 40px auto;}
 input[type=file], input[type=text] {padding: 4px; font-size: 1em;}
 button {padding: 6px 10px; margin-left: 4px;}
 pre {white-space: pre-wrap; background:#f5f5f5; padding:12px;}

 /* tiny bars in summary table */
 table#fb td {min-width: 60px;}
</style>
</head><body>

<h2>AI Manuals Helper</h2>

<!---------------------------- 1.  Upload ----------------------------------->
<h4>Upload a PDF</h4>
<input type="file" id="pdf">
<button onclick="upload()">Upload</button>

<!---------------------------- 2.  Ask -------------------------------------->
<h4 style="margin-top:32px;">Ask a question</h4>
<input id="q" size="60" placeholder="Type your question…">
<button onclick="ask()">Ask</button>

<pre id="a"></pre>
<div id="fbBtns" style="display:none;">
  Helpful?
  <button onclick="sendFeedback(1)">👍</button>
  <button onclick="sendFeedback(-1)">👎</button>
</div>

<hr>

<!---------------------------- 3.  Feedback summary ------------------------->
<h4>📈 Feedback (last 7 days)</h4>
<table id="fb" border="1" cellpadding="4">
  <tr><th>Date</th><th>👍</th><th>👎</th></tr>
</table>

<script>
let lastQuestion = "";
let lastAnswer   = "";
let lastChunks   = [];

async function upload(){
  const fd = new FormData();
  fd.append("file", pdf.files[0]);
  const r = await fetch("/upload", {method:"POST", body:fd});
  alert("Uploaded " + (await r.json()).file);
}

async function ask(){
  lastQuestion = q.value;
  const fd = new FormData();
  fd.append("question", lastQuestion);
  const r  = await fetch("/chat", {method:"POST", body:fd});
  const json = await r.json();          // {answer:"…", chunks:[…]}
  a.textContent = json.answer;
  lastAnswer  = json.answer;
  lastChunks  = json.chunks;            // ← store the array
}

async function sendFeedback(score){
  await fetch("/feedback", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      customer: "demo01",
      question: lastQuestion,
      answer:   lastAnswer,
      score:    score,
      chunks_used: lastChunks            // ← send it
    })
  });
}
</script>
</body></html>
