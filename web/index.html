<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Manuals Demo</title>
  <style>
    body{font-family:sans-serif;max-width:680px;margin:auto;padding:20px}
    #answer{white-space:pre-wrap;border:1px solid #ccc;padding:12px}
    .fb{font-size:20px;margin:0 6px;cursor:pointer}
  </style>
</head>
<body>
<h2>Manual helper</h2>

<h4>Upload a PDF</h4>
<input type="file" id="pdf">
<button onclick="upload()">Upload</button><br><br>

<h4>Ask a question</h4>
<input id="q" size="60" placeholder="Type your question‚Ä¶">
<button onclick="ask()">Ask</button><br><br>

<div id="answer"></div>
<div id="fb" style="display:none;">
  <span class="fb" onclick="sendFeedback( 1)">üëç</span>
  <span class="fb" onclick="sendFeedback(-1)">üëé</span>
</div>
<p><a href="/dashboard.html" target="_blank">üìä See feedback dashboard</a></p>

<script>
let lastQuestion="", lastAnswer="", lastChunks=[];

async function upload(){
  const fd=new FormData(); fd.append("file",pdf.files[0]);
  const r = await fetch("/upload",{method:"POST",body:fd});
  alert("Uploaded "+ (await r.json()).file);
}

async function ask(){
  const fd=new FormData(); fd.append("question",q.value);
  const r  = await fetch("/chat",{method:"POST",body:fd});
  const out= await r.json();
  /* ===== store context for feedback ===== */
  lastQuestion = q.value;
  lastAnswer   = out.answer;
  lastChunks   = out.chunks_used;      //  ‚Üê  renamed
  /* ===== render ===== */
  answer.textContent = lastAnswer;
  fb.style.display   = "inline";
}

async function sendFeedback(score){
  const r = await fetch("/feedback",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      customer:"demo01",
      question:lastQuestion,
      answer:  lastAnswer,
      score:   score,
      chunks_used: lastChunks        //  ‚Üê  renamed
    })
  });
  const resp = await r.json();
  if(resp.ok){
    alert("Thanks for the feedback!");
    fb.style.display="none";
  }else alert("Feedback failed: "+JSON.stringify(resp));
}
</script>
</body>
</html>
